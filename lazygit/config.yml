customCommands:
  - key: <c-a>
    description: Lazycommit
    command: |
      (
        saved_stty=$(stty -g 2>/dev/null || true)

        cleanup() {
          [ -n "$saved_stty" ] && stty "$saved_stty" 2>/dev/null || true
          tput reset 2>/dev/null || true
        }

        trap cleanup EXIT INT TERM

        aichat -m gemini:gemini-2.5-flash-preview-05-20 "Generate 6 semantic commit messages for these changes. Use imperative mood, max 50 chars each.

        Recent commits for context:
        $(git log -n 6 --pretty=format:'%h %s')

        Changes to commit:
        $(git diff --cached)" \
          | jq -r '.commits[] | "\(.type): \(.message)"' \
          | fzf --height 41% --border --ansi --preview "echo {}" --preview-window=up:wrap \
          | (read -r message && git commit --no-verify -m "$message")
      )
    context: files
    subprocess: true
